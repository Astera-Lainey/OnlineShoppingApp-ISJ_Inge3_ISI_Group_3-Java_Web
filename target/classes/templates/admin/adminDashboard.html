<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" >
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
	<!-- title -->
	<title>Admin Page</title>
	<!-- favicon -->
	<link rel="shortcut icon" type="image/png" th:href="@{/assets/img/favicon.png}">
	<!-- fontawesome -->
	<link rel="stylesheet" th:href="@{/assets/css/all.min.css}">
	<!-- bootstrap -->
	<link rel="stylesheet" th:href="@{/assets/bootstrap/css/bootstrap.min.css}">
	<!-- owl carousel -->
	<link rel="stylesheet" th:href="@{/assets/css/owl.carousel.css}">
	<!-- magnific popup -->
	<link rel="stylesheet" th:href="@{/assets/css/magnific-popup.css}">
	<!-- animate css -->
	<link rel="stylesheet" th:href="@{/assets/css/animate.css}">
	<!-- mean menu css -->
	<link rel="stylesheet" th:href="@{/assets/css/meanmenu.min.css}">
	<!-- main style -->
	<link rel="stylesheet" th:href="@{/assets/css/main.css}">
	<!-- responsive -->
	<link rel="stylesheet" th:href="@{/assets/css/responsive.css}">
	<style>
		.dropdown-menu,.dropdown,.dropdown-item{
			z-index: 2;
			font-size: 15px;
		}
        table{
            img{
                width: 45px;
            }
        }
		.single-product-item{ 
			border-radius: 4%;
			height: 70%;
		p{
			font-size: 20px;
			font-weight: bold;
		}
		img{
			height: 30%;
			width: 30%;
		}
		a{
			position: relative; bottom: 20px;
		}
	}
		.breadcrumb-section{
			padding-top: 50px;
		}
		#container {
			display: flex;
			flex-wrap: wrap;
			gap: 10px;
		}
		input[type=file] {
			display: block;
			margin-top: 10px;
			margin-bottom: 30px;
			border: 2px solid #49C8FC;
			padding: 5px;
		}
		p{
			font-size: 18px;
		}
	</style>
</head>
<body>
	
	<!--PreLoader-->
    <div class="loader">
        <div class="loader-inner">
            <div class="circle"></div>
        </div>
    </div>
    <!--PreLoader Ends-->

	<!-- header -->
	<div class="top-header-area" id="sticker">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 col-sm-12 text-center">
					<div class="main-menu-wrap">
						<!-- logo -->
						<div class="site-logo">
							<a th:href="@{/user/main}">
								<img th:src="@{/assets/img/logo.png}" alt="">
							</a>
						</div>
						<!-- logo -->

						<!-- menu start -->
						<nav class="main-menu" >
							<ul>
								<!--Profile Settings added -->
								<div th:replace="~{fragments/user-dropdown :: user-dropdown}"></div>
							</ul>
						</nav>
						<a class="mobile-show search-bar-icon" href="#"><i class="fas fa-search"></i></a>
						<div class="mobile-menu"></div>
						<!-- menu end -->
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end header -->


	<!-- breadcrumb-section -->
	<div class="breadcrumb-section breadcrumb-bg" style="background-image: url('/assets/img/feature-bg.jpg');">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 offset-lg-2 text-center">
					<div class="breadcrumb-text">
						<h1>Admin Dashboard</h1>
						<p>Manage your online store</p>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end breadcrumb section -->

	<!-- product section -->
	<div class="product-section mt-80 mb-80">
		<div class="row m-2">
			<div class="col-lg-3 col-md-6 text-center">
				<div class="single-product-item">
					<div class="profile d-flex p-4">
					<img th:src="@{/assets/img/user (1).png}" alt="">
					<div class="text">
					<h4 class="pl-5">Active Users</h4>
					<p class="pl-5">7</p>
					</div>
					</div>
					<a href="#" class="boxed-btn">View</a>
				</div>
			</div>
			<div class="col-lg-3 col-md-6 text-center">
				<div class="single-product-item">
					<div class="profile d-flex p-4">
					<img th:src="@{/assets/img/user (1).png}" alt="">
					<div class="text">
					<h4 class="pl-5">Total Users</h4>
					<p class="pl-5"><span th:text="${totalUsers}"></span></p>
					</div>
					</div>
					<a href="#" class="boxed-btn">View</a>
				</div>
			</div>
			<div class="col-lg-3 col-md-6 offset-md-3 offset-lg-0 text-center">
				<div class="single-product-item">
					<div class="profile d-flex p-4">
					<img th:src="@{/assets/img/user (1).png}" alt="">
					<div class="text">
					<h4 class="pl-5">All Products</h4>
					<p class="pl-5"> <span th:text="${#lists.size(products)}"></span></p>
					</div>
					</div>
					<a href="#" class="boxed-btn">View</a>
				</div>
			</div>
			<div class="col-lg-3 col-md-6 offset-md-3 offset-lg-0 text-center">
				<div class="single-product-item">
					<div class="profile d-flex p-4">
					<img th:src="@{/assets/img/user (1).png}" alt="">
					<div class="text">
					<h4 class="pl-5">All Orders</h4>
					<p class="pl-5">7</p>	
					</div>
					</div>
					<a href="#" class="boxed-btn">View</a>
				</div>
			</div>
			<!-- Add Inventory Stats Card -->
			<div class="col-lg-3 col-md-6 text-center">
				<div class="single-product-item">
					<div class="profile d-flex p-4">
						<img th:src="@{/assets/img/inventory.png}" alt="">
						<div class="text">
							<h4 class="pl-5">Low Stock Items</h4>
							<p class="pl-5" th:text="${lowStockCount}">0</p>
						</div>
					</div>
					<a href="#inventory-section" class="boxed-btn">Manage</a>
				</div>
			</div>
			<!-- Add Notifications Card -->
			<div class="col-lg-3 col-md-6 text-center">
				<div class="single-product-item">
					<div class="profile d-flex p-4">
						<img th:src="@{/assets/img/notification.png}" alt="">
						<div class="text">
							<h4 class="pl-5">Notifications</h4>
							<p class="pl-5" th:text="${unreadNotificationCount}">0</p>
						</div>
					</div>
					<a href="#notifications-section" class="boxed-btn" onclick="showNotifications()">View</a>
				</div>
			</div>
		</div>
	</div>

	<!-- Notifications Section -->
	<div id="notifications-section" class="mb-4" style="display: none;">
		<div class="section-title">
			<h3><span class="orange-text">Stock</span> Notifications</h3>
		</div>
		<div class="table-responsive">
			<table class="table">
				<thead>
					<tr>
						<th>Date</th>
						<th>Product</th>
						<th>Type</th>
						<th>Message</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody id="notificationsTableBody">
					<!-- Notifications will be loaded here -->
				</tbody>
			</table>
		</div>
		<button class="boxed-btn" onclick="markAllNotificationsAsRead()">Mark All as Read</button>
	</div>

	<!-- Inventory Management Section -->
	<div id="inventory-section" class="mb-4">
		<div class="section-title">
			<h3><span class="orange-text">Inventory</span> Management</h3>
		</div>
		<div class="table-responsive">
			<table class="table">
				<thead>
					<tr>
						<th>Product</th>
						<th>Category</th>
						<th>Current Stock</th>
						<th>Initial Stock</th>
						<th>Status</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="product : ${products}">
						<td>
							<div class="d-flex align-items-center">
								<img th:if="${product.images != null && !product.images.isEmpty()}"
									 th:src="@{${product.images[0].path}}"
									 alt="Product Image"
									 style="width: 50px; height: 50px; object-fit: cover; margin-right: 10px;">
								<div>
									<strong th:text="${product.name}">Product Name</strong>
								</div>
							</div>
						</td>
						<td th:text="${product.category}">Category</td>
						<td>
							<span th:text="${product.stockQuantity}"
								  th:class="${product.stockQuantity <= (product.initialStockQuantity * 0.25) ? 'text-danger' : ''}">
								Stock
							</span>
						</td>
						<td th:text="${product.initialStockQuantity}">Initial Stock</td>
						<td>
							<span th:if="${product.stockQuantity <= 0}"
								  class="badge bg-danger">Out of Stock</span>
							<span th:elseif="${product.stockQuantity <= (product.initialStockQuantity * 0.25)}"
								  class="badge bg-warning">Low Stock</span>
							<span th:else
								  class="badge bg-success">In Stock</span>
						</td>
						<td>
							<button class="btn btn-sm btn-primary" 
									th:onclick="'updateStock(' + ${product.id} + ')'">
								Update Stock
							</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

	<!-- Update Stock Modal -->
	<div class="modal fade" id="updateStockModal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Update Stock</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">
					<form id="updateStockForm">
						<input type="hidden" id="productId">
						<div class="mb-3">
							<label for="newStock" class="form-label">New Stock Quantity</label>
							<input type="number" class="form-control" id="newStock" required min="0">
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="button" class="btn btn-primary" onclick="submitStockUpdate()">Update</button>
				</div>
			</div>
		</div>
</div>

	<!-- Data Tables -->
	<center>

		<div class="col-lg-10">
			<div class="demo-inline-spacing mt-4" style="font-size: 18px;">
				<div class="list-group list-group-horizontal-md text-md-center">
					<a
							class="list-group-item list-group-item-action active"
							id="home-list-item"
							data-bs-toggle="list"
							href="#horizontal-home"
					>Products</a
					>
					<a
							class="list-group-item list-group-item-action"
							id="profile-list-item"
							data-bs-toggle="list"
							href="#horizontal-profile"
					>Orders</a
					>
					<a
							class="list-group-item list-group-item-action"
							id="messages-list-item"
							data-bs-toggle="list"
							href="#horizontal-messages"
					>Customers</a
					>
					<a
							class="list-group-item list-group-item-action"
							id="settings-list-item"
							data-bs-toggle="list"
							href="#horizontal-settings"
					>Reviews</a
					>
				</div>
				<div class="tab-content px-0 pt-1 mt-0">
					<div class="tab-pane fade show active" id="horizontal-home">
						<div class="row">
							<div class="section-title m-5">
								<center>
									<h3><span class="orange-text">Product </span>Management </h3>
								</center>
							</div>
						</div>
						<!-- Search Wrapper -->
						<div class="search-wrapper">

							<div class="container">
								<div class="row">
									<div class="col-12">
										<form action="#" method="post">
											<input type="text" name="keyword" id="keyword" placeholder="Search for Products..." th:value="${keyword}">
											<button type="button" onclick="search()"><i class="fa fa-search" aria-hidden="true"></i></button>
										</form>
									</div>
								</div>
							</div>
						</div>
						<div class="col-10" style="padding-top: 35px;">
							<div class="card overflow-hidden" style="height: 400px; ">
								<div class="table-responsive">
									<table class="table table-sm table-hover">
										<thead class="table-light fs-4">
										<tr style="position: sticky; top: 0;">
											<th class="text-truncate" style="position: sticky; top: 0;">Product</th>
											<th class="text-truncate" style="position: sticky; top: 0;">Category</th>
											<th class="text-truncate" style="position: sticky; top: 0;">Price (XAF)</th>
											<th class="text-truncate" style="position: sticky; top: 0;">Quantity</th>
											<th class="text-truncate" style="position: sticky; top: 0;">Actions</th>
										</tr>
										</thead>
										<tbody>
										<tr th:each="product : ${products}">
											<td>
													<h6 class="mt-3"><span th:text="${product.name}"></span> </h6>
											</td>
											<td th:text="${product.category.name()}"></td>
											<td th:text="${product.price}"></td>
											<td th:text="${product.stockQuantity}"></td>
											<td>
												<div class="dropdown" style="z-index: 2;">
													<button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
														<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">
															<path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
														</svg>
													</button>
													<div class="dropdown-menu">
														<a class="dropdown-item" href="javascript:void(0);" data-bs-toggle="modal" th:data-bs-target="'#viewProductModal' + ${product.id}">
															<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16">
																<path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0"/>
																<path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8m8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7"/>
															</svg> View Details </a>
														<a class="dropdown-item" href="javascript:void(0);" data-bs-toggle="modal" th:data-bs-target="'#editProductModal' + ${product.id}">
															<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
																<path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
																<path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/>
															</svg> Edit Product </a>
														<a class="dropdown-item" href="javascript:void(0);" data-bs-toggle="modal" th:data-bs-target="'#deleteProductModal' + ${product.id}" >
															<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-trash3" viewBox="0 0 16 16">
																<path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47M8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5"/>
															</svg> Delete Product </a>


													</div>

												</div>
												<!--Delete Product Modal -->
												<div class="modal modal-top"  th:id="'deleteProductModal' + ${product.id}" tabindex="-1">
													<div class="modal-dialog modal-dialog-centered modal-sm">
														<div class="modal-content modal-dialog-centered">
															<div class="modal-body">
																<div class="row">
																	<div class="col">
																		<h4 class="fs-4">Delete Product?</h4>
																		<p>This action cannot be undone!</p>
																	</div>
																</div>
															</div>
															<div class="modal-footer modal-dialog-centered">
																<button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">
																	Cancel
																</button>
																<form th:action="@{/delete/{name}(name=${product.name})}"  method="post">
																	<input type="hidden" name="_method" value="delete" />
																	<button type="submit" class="btn btn-danger">
																		<i class="ri-delete-bin-6-line me-1"></i>
																		Yes
																	</button>
																</form>
															</div>
														</div>
													</div>
												</div>
												<!-- /Delete Product modal -->


												<!-- Edit Product Details Modal-->
												<div class="modal modal-top" th:id="'editProductModal' + ${product.id}" aria-hidden="true" tabindex="-1" >
													<div class="modal-dialog modal-dialog-centered">
														<div class="modal-content">
														<form th:action="@{/update/{id}(id=${product.id})}" method="post" >
																<div class="modal-header">
																	<h5 class="modal-title" id="modalToggleLabel2">Edit Stock Quantity </h5>
																	<button
																			type="button"
																			class="btn-close"
																			data-bs-dismiss="modal"
																			aria-label="Close"></button>
																</div>
																<div class="modal-body">
																	<div class="row">
																		<div class="col mb-6 mt-2">
																			<label>Product Name</label>
																			<div class="form-control" th:text="${product.name}" style="font-size: 24px;"></div>
																		</div>
																	</div>
																	<div class="row">
																		<div class="col-12 mb-6 mt-2">
																			<label>Stock Quantity</label>
																			<div>
																				<input type="number" name="stockQuantity" min="0" th:value="${product.stockQuantity}" required style="height: 60px; width: 100%"/>
																			</div>
																			</div>
																	</div>
																</div>
																<div class="modal-footer">
																	<button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
																		Cancel
																	</button>
																	<button type="submit" class="btn btn-primary">
																		Update Stock
																	</button>
																</div>

														</form>
													</div>
													</div>
												</div>
												<!-- /Edit Product Details Modal-->

												<!-- View Product Details Modal-->
												<div class="modal modal-top" th:id="'viewProductModal' + ${product.id}" tabindex="-1" style="display: none" aria-hidden="true">
													<div class="modal-dialog modal-dialog-centered">
														<div class="modal-content">
															<div class="modal-header">
																<h5 class="modal-title" id="modalToggleLabel">View Product Details</h5>
																<button
																		type="button"
																		class="btn-close"
																		data-bs-dismiss="modal"
																		aria-label="Close"></button>
															</div>
															<div class="modal-body fs-4">
																<div class="row d-flex" style="display: flex; flex-wrap: wrap; flex-direction: row">
																		<img th:each="image : ${images}" 
																			 th:if="${image.imageUrl != null && image.productId == product.id}" 
																			 th:src="@{/${image.imageUrl}}" 
																			 alt="Product Image" 
																			 style="width: 30%; height: 100px; margin-right: 10px; margin-top: 10px; border-radius: 10px; border: solid 2px #F0CB46"/>
																</div>
																<div>
																<p style="font-size: 21px; font-weight: 900">Product Name: <span th:text="${product.name}" style="font-size: 19px;"></span></p>
																<p style="font-size: 21px; font-weight: 900">Brand: <span th:text="${product.brand}" style="font-size: 19px;"></span></p>
																<p style="font-size: 21px; font-weight: 900">Category: <span th:text="${product.category.name()}" style="font-size: 19px;"></span></p>
																<p style="font-size: 21px; font-weight: 900">Description: <span th:text="${product.description}" style="font-size: 19px;"></span></p>
																<p style="font-size: 21px; font-weight: 900">Quantity: <span th:text="${product.stockQuantity}" style="font-size: 19px;"></span> </p>
																</div>

															</div>
															<div class="modal-footer">
																<button
																		class="btn btn-primary"
																		data-bs-dismiss="modal">
																	Close
																</button>
															</div>
														</div>
													</div>
												</div>


											</td>
										</tr>


										</tbody>
									</table>



								</div>
							</div>
						</div>
						<div class="mt-5">
							<button style="display: block; margin: 0 auto; border-radius: 50px; font-weight: 900; font-size: 15px;" class="boxed-btn" data-bs-toggle="modal" data-bs-target="#addModal">Create Product</button>

						</div>
					</div>
					<div class="tab-pane fade" id="horizontal-profile">
						<!-- -----------------------ORDERS--------------------- -->
						<div class="row">
							<div class="section-title m-5">
								<center>
									<h3><span class="orange-text">Order </span>Management </h3>
								</center>
							</div>
						</div>
						<!-- Order Status Filter -->
						<div class="row mb-4">
							<div class="col">
								<div class="btn-group" role="group">
									<button type="button" 
											class="btn btn-outline-primary" 
											th:classappend="${currentStatus == T(OnlineShopping.entity.Order.OrderStatus).PENDING ? 'active' : ''}"
											data-status="PENDING">Pending</button>
									<button type="button" 
											class="btn btn-outline-primary" 
											th:classappend="${currentStatus == T(OnlineShopping.entity.Order.OrderStatus).CONFIRMED ? 'active' : ''}"
											data-status="CONFIRMED">Confirmed</button>
									<button type="button" 
											class="btn btn-outline-primary" 
											th:classappend="${currentStatus == T(OnlineShopping.entity.Order.OrderStatus).SHIPPING ? 'active' : ''}"
											data-status="SHIPPING">Shipping</button>
									<button type="button" 
											class="btn btn-outline-primary" 
											th:classappend="${currentStatus == T(OnlineShopping.entity.Order.OrderStatus).DELIVERED ? 'active' : ''}"
											data-status="DELIVERED">Delivered</button>
									<button type="button" 
											class="btn btn-outline-primary" 
											th:classappend="${currentStatus == T(OnlineShopping.entity.Order.OrderStatus).CANCELLED ? 'active' : ''}"
											data-status="CANCELLED">Cancelled</button>
								</div>
							</div>
						</div>
						<!-- Search Wrapper -->
						<div class="search-wrapper">
							<div class="container">
								<div class="row">
									<div class="col-12">
										<form action="#" method="post">
											<input type="search" id="orderSearch" name="search" placeholder="Search orders...">
											<button type="button" onclick="searchOrders()"><i class="fa fa-search" aria-hidden="true"></i></button>
										</form>
									</div>
								</div>
							</div>
						</div>
						<div class="col-10" style="padding-top: 35px;">
							<div class="card overflow-hidden" style="height: 400px; ">
								<div class="table-responsive">
									<table class="table table-sm table-hover">
										<thead class="table-light fs-4">
										<tr style="position: sticky; top: 0;">
											<th class="text-truncate" style="position: sticky; top: 0;">Order ID</th>
											<th class="text-truncate" style="position: sticky; top: 0;">Date</th>
											<th class="text-truncate" style="position: sticky; top: 0;">Customer</th>
											<th class="text-truncate" style="position: sticky; top: 0;">Products</th>
											<th class="text-truncate" style="position: sticky; top: 0;">Total (XAF)</th>
											<th class="text-truncate" style="position: sticky; top: 0;">Status</th>
											<th class="text-truncate" style="position: sticky; top: 0;">Actions</th>
										</tr>
										</thead>
										<tbody>
										<tr th:each="order : ${orders}">
											<td><h6 th:text="${order.id}">#123</h6></td>
											<td th:text="${#temporals.format(order.createdAt, 'yyyy-MM-dd HH:mm')}">2024-03-20</td>
											<td>
												<span th:text="${order.user.firstName + ' ' + order.user.lastName}">John Doe</span><br>
												<small th:text="${order.user.email}" class="text-muted">john@example.com</small>
											</td>
											<td>
												<div class="d-flex flex-column">
													<div th:each="item : ${order.items}" class="mb-1">
														<small>
															<span th:text="${item.product.name}">Product Name</span>
															<span class="text-muted">(x</span>
															<span th:text="${item.quantity}">1</span>
															<span class="text-muted">)</span>
														</small>
													</div>
												</div>
											</td>
											<td th:text="${#numbers.formatCurrency(order.total)}">50000</td>
											<td>
												<span th:class="${'badge ' + 
													(order.status == T(OnlineShopping.entity.Order.OrderStatus).PENDING ? 'bg-warning' : 
													(order.status == T(OnlineShopping.entity.Order.OrderStatus).CONFIRMED ? 'bg-info' : 
													(order.status == T(OnlineShopping.entity.Order.OrderStatus).SHIPPING ? 'bg-primary' : 
													(order.status == T(OnlineShopping.entity.Order.OrderStatus).DELIVERED ? 'bg-success' : 
													'bg-danger'))))}"
													th:text="${order.status}">PENDING</span>
											</td>
											<td>
												<div class="dropdown" style="z-index: 1;">
													<button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
														<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">
															<path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
														</svg>
													</button>
													<div class="dropdown-menu">
														<a class="dropdown-item" href="javascript:void(0);" 
														   th:onclick="'viewOrder(' + ${order.id} + ')'">
															<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16">
																<path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0"/>
																<path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8m8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7"/>
															</svg> View Details
														</a>
														<div class="dropdown-divider"></div>
														<a class="dropdown-item" href="javascript:void(0);" 
														   th:if="${order.status == T(OnlineShopping.entity.Order.OrderStatus).PENDING}"
														   th:onclick="'updateOrderStatus(' + ${order.id} + ', \'CONFIRMED\')'">
															<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16">
																<path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293z"/>
															</svg> Confirm Order
														</a>
														<a class="dropdown-item" href="javascript:void(0);" 
														   th:if="${order.status == T(OnlineShopping.entity.Order.OrderStatus).CONFIRMED}"
														   th:onclick="'updateOrderStatus(' + ${order.id} + ', \'SHIPPING\')'">
															<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-truck" viewBox="0 0 16 16">
																<path d="M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-3.998-.085A1.5 1.5 0 0 1 0 10.5zm1.294 7.456A1.999 1.999 0 0 1 4.732 11h5.536a2.01 2.01 0 0 1 .732-.732V3.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .294.456M12 10a.5.5 0 0 1 .5.5v3a.5.5 0 1 1-1 0v-3A.5.5 0 0 1 12 10m-9 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2m9 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2"/>
															</svg> Mark as Shipping
														</a>
														<a class="dropdown-item" href="javascript:void(0);" 
														   th:if="${order.status == T(OnlineShopping.entity.Order.OrderStatus).SHIPPING}"
														   th:onclick="'updateOrderStatus(' + ${order.id} + ', \'DELIVERED\')'">
															<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-seam-fill" viewBox="0 0 16 16">
																<path fill-rule="evenodd" d="M15.528 2.973a.75.75 0 0 1 .472.696v8.662a.75.75 0 0 1-.472.696l-7.25 2.9a.75.75 0 0 1-.557 0l-7.25-2.9A.75.75 0 0 1 0 12.331V3.669a.75.75 0 0 1 .471-.696L7.443.184l.01-.003.268-.108a.75.75 0 0 1 .558 0l.269.108.01.003zM10.404 2 4.25 4.461 1.846 3.5 1 3.839v.4l6.5 2.6v7.922l.5.2.5-.2V6.84l6.5-2.6v-.4l-.846-.339L8 5.961 5.596 5l6.154-2.461z"/>
															</svg> Mark as Delivered
														</a>
														<div class="dropdown-divider"></div>
														<a class="dropdown-item text-danger" href="javascript:void(0);" 
														   th:if="${order.status != T(OnlineShopping.entity.Order.OrderStatus).DELIVERED && 
																   order.status != T(OnlineShopping.entity.Order.OrderStatus).CANCELLED}"
														   th:onclick="'updateOrderStatus(' + ${order.id} + ', \'CANCELLED\')'">
															<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle-fill" viewBox="0 0 16 16">
																<path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293z"/>
															</svg> Cancel Order
														</a>
													</div>
												</div>
											</td>
										</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>

						<!-- Order Details Modal -->
						<div class="modal fade" id="orderDetailsModal" tabindex="-1">
							<div class="modal-dialog modal-lg">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title">Order Details</h5>
										<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
								</div>
									<div class="modal-body">
										<div class="row mb-4">
											<div class="col-md-6">
												<h6>Customer Information</h6>
												<p id="customerInfo"></p>
											</div>
											<div class="col-md-6">
												<h6>Shipping Information</h6>
												<p id="shippingInfo"></p>
											</div>
										</div>
										<h6>Order Items</h6>
										<div class="table-responsive">
											<table class="table">
												<thead>
													<tr>
														<th>Product</th>
														<th>Image</th>
														<th>Quantity</th>
														<th>Price</th>
														<th>Total</th>
													</tr>
												</thead>
												<tbody id="orderItems">
												</tbody>
												<tfoot>
													<tr>
														<td colspan="4" class="text-end"><strong>Subtotal:</strong></td>
														<td id="subtotal"></td>
													</tr>
													<tr>
														<td colspan="4" class="text-end"><strong>Shipping:</strong></td>
														<td id="shipping"></td>
													</tr>
													<tr>
														<td colspan="4" class="text-end"><strong>Total:</strong></td>
														<td id="total"></td>
													</tr>
												</tfoot>
											</table>
										</div>
									</div>
								</div>
							</div>
						</div>

						<script th:inline="javascript">
							// View order details
							function viewOrder(orderId) {
								fetch(`/api/orders/${orderId}`)
									.then(response => response.json())
									.then(order => {
										// Update customer info
										document.getElementById('customerInfo').innerHTML = `
											<strong>Name:</strong> ${order.user.firstName} ${order.user.lastName}<br>
											<strong>Email:</strong> ${order.user.email}<br>
											<strong>Phone:</strong> ${order.user.phone || 'N/A'}
										`;

										// Update shipping info
										document.getElementById('shippingInfo').innerHTML = `
											<strong>Address:</strong> ${order.shippingAddress}<br>
											<strong>City:</strong> ${order.shippingCity}<br>
											<strong>State:</strong> ${order.shippingState}<br>
											<strong>ZIP:</strong> ${order.shippingZipCode}<br>
											<strong>Phone:</strong> ${order.shippingPhone}<br>
											<strong>Notes:</strong> ${order.notes || 'No additional notes'}
										`;

										// Update order items
										const itemsHtml = order.items.map(item => `
											<tr>
												<td>
													<strong>${item.product.name}</strong><br>
													<small class="text-muted">${item.product.category || 'No category'}</small>
												</td>
												<td>
													<img th:if="${item.product.images && item.product.images.length > 0}"
														 th:src="@{${item.product.images[0].imageUrl}}"
														 alt="${item.product.name}"
														 style="width: 50px; height: 50px; object-fit: cover;"
														 onerror="this.src='/assets/img/no-image.png'">
													<img th:unless="${item.product.images && item.product.images.length > 0}"
														 src="/assets/img/no-image.png"
														 alt="${item.product.name}"
														 style="width: 50px; height: 50px; object-fit: cover;">
												</td>
												<td>${item.quantity}</td>
												<td>${new Intl.NumberFormat('en-US', { style: 'currency', currency: 'XAF' }).format(item.price)}</td>
												<td>${new Intl.NumberFormat('en-US', { style: 'currency', currency: 'XAF' }).format(item.totalPrice)}</td>
											</tr>
										`).join('');
										document.getElementById('orderItems').innerHTML = itemsHtml;

										// Update totals
										document.getElementById('subtotal').textContent = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'XAF' }).format(order.subtotal);
										document.getElementById('shipping').textContent = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'XAF' }).format(order.shippingCost);
										document.getElementById('total').textContent = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'XAF' }).format(order.total);

										// Show modal
										new bootstrap.Modal(document.getElementById('orderDetailsModal')).show();
									})
									.catch(error => {
										console.error('Error:', error);
										alert('Error loading order details');
									});
							}

							// Update order status
							function updateOrderStatus(orderId, status) {
								if (!confirm(`Are you sure you want to mark this order as ${status}?`)) {
									return;
								}

								console.log(`Updating order ${orderId} to status: ${status}`);

								fetch(`/api/orders/${orderId}/status?status=${status}`, {
									method: 'POST',
									headers: {
										'Content-Type': 'application/json',
										'X-Requested-With': 'XMLHttpRequest'
									}
								})
								.then(response => {
									console.log('Response status:', response.status);
									if (!response.ok) {
										throw new Error(`HTTP error! status: ${response.status}`);
									}
									return response.json();
								})
								.then(data => {
									console.log('Response data:', data);
									
									if (data.success) {
										// Show success message
										alert(`Order status updated successfully to ${status}!`);
										
										// Reload the page to show updated status
										window.location.reload();
									} else {
										// Show error message
										alert(`Error: ${data.error || 'Unknown error occurred'}`);
									}
								})
								.catch(error => {
									console.error('Error updating order status:', error);
									
									// Try to parse error response
									if (error.message && error.message.includes('HTTP error')) {
										alert('Server error occurred while updating order status. Please try again.');
									} else {
										alert('Error updating order status: ' + error.message);
									}
								});
							}

							// Filter orders by status
							document.querySelectorAll('[data-status]').forEach(button => {
								button.addEventListener('click', function() {
									const status = this.dataset.status;
									window.location.href = `/admin/adminDashboard?status=${status}`;
								});
							});

							// Search orders
							function searchOrders() {
								const searchTerm = document.getElementById('orderSearch').value;
								window.location.href = `/admin/adminDashboard?search=${encodeURIComponent(searchTerm)}`;
							}
						</script>

					</div>
					<div class="tab-pane fade" id="horizontal-messages">
						<center>
							<div class="container">
								<div class="row">
									<div class="section-title text-center m-5" style="display: block; margin: 0 auto;">
										<center>
											<h3><span class="orange-text">User</span> Management</h3>
										</center>
									</div>
								</div>
							</div>
							<!-- Data Tables -->
							<center>
								<div class="col-10 mb-50">
									<div class="card overflow-hidden" style="height: 400px; ">
										<div class="table-responsive">
											<table class="table table-sm table-hover" id="usersTable">
												<thead class="table-light fs-4">
												<tr style="position: sticky; top: 0;">
													<th class="text-truncate" style="position: sticky; top: 0;">User</th>
													<th class="text-truncate" style="position: sticky; top: 0;">Email</th>
													<th class="text-truncate" style="position: sticky; top: 0;">Actions</th>
												</tr>
												</thead>
												<tbody id="usersTableBody">
												<!-- User data will be dynamically inserted here by JavaScript -->
												</tbody>
											</table>
										</div>
									</div>
								</div>
							</center>
							<!--/ Data Tables -->
						</center>

					</div>
					<div class="tab-pane fade" id="horizontal-settings">
						Reviewss here :/
					</div>
				</div>
			</div>
		</div>

	</center>

                <!--/ Data Tables -->





	<!-- Add New Product Modal -->
	<div class="modal" id="addModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
			<div class="modal-content">
				<form th:action="@{/add}" method="post" enctype="multipart/form-data" th:object="${productform}">
					<div class="modal-header">
						<h5 class="modal-title">Create A New Product</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<div class="row g-4">
							<div class="col mb-2">
								<div class="form-floating form-floating-outline">
									<input
											type="text"
											class="form-control"
											placeholder="Enter Name"  th:field="${productform.name}" required style="height: 60px;"/>
									<label>Product Name</label>
								</div>
							</div>
							<div class="col mb-2">
								<div class="form-floating form-floating-outline">
									<input type="text" class="form-control" placeholder="Enter Brand" th:field="${productform.brand}" required style="height: 60px;"/>
									<label>Product Brand</label>
								</div>
							</div>
						</div>
						<br>
						<div class="row">
							<div class="col mb-6 mt-2">
								<div class="form-floating form-floating-outline">
									<select class="form-control" th:field="${productform.category}" required style="height: 60px;">
										<option th:each="cat : ${cats}" th:value="${cat}" th:text="${cat}"></option>
									</select>
									<label>Product Category</label>
								</div>
							</div>
						</div><br>
						<div class="row g-4">
							<div class="col-5 mb-2">
								<div class="form-floating form-floating-outline">
									<input
											type="number"
											class="form-control"
											placeholder="Enter Price of Product" th:field="${productform.price}" required style="height: 60px; width: 100%"/>
									<label>Unit Price</label>
								</div>
							</div>
							<div class="col mb-2">
								<div class="form-floating form-floating-outline">
									<input type="text" class="form-control" placeholder="How much is in stock" th:field="${productform.stock}" required style="height: 60px;"/>
									<label>Stock Quantity</label>
								</div>
							</div>
						</div>

						<div class="row">
							<div class="col mb-6 mt-2">
								<label>Product Pictures</label>
								<div class="pic">
									<input type="file" name="" id="file-input" accept="jpg" th:field="${productform.image}" multiple required>
									<div id="container"></div>
								</div>

							</div>
						</div>



						<div class="row">
							<div class="col mb-6 mt-2">
								<div class="form-floating form-floating-outline">
										<textarea
												id="basic-icon-default-message"
												class="form-control"
												placeholder="Enter Product Description"
												aria-describedby="basic-icon-default-message2" th:field="${productform.description}" required style="height: 80px;"></textarea>
									<label>Product Details</label>
								</div>
							</div>
						</div>



					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">Create Product</button>
					</div>
				</form>

			</div>
		</div>
	</div>

	<!-- /Add New Product Modal -->

	<!--			User Modal-->
	<!--Delete Modal -->
	<div class="modal modal-top" id="deleteUser" tabindex="-1">
		<div class="modal-dialog modal-dialog-centered modal-sm">
			<form class="modal-content modal-dialog-centered" id="deleteUserForm">
				<div class="modal-body">
					<div class="row">
						<div class="col">
							<p class="fs-4">Delete User?</p>
							<p>Are you sure you want to delete this user? This action cannot be undone.</p>
							<input type="hidden" id="deleteUserId">
						</div>
					</div>
				</div>
				<div class="modal-footer modal-dialog-centered">
					<button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
						Cancel
					</button>
					<button type="submit" class="btn btn-danger">Yes, Delete</button>
				</div>
			</form>
		</div>
	</div>
	<!-- /Delete modal -->

	<!-- Edit Modal -->
	<div class="modal modal-top fade" id="editModal" tabindex="-1">
		<div class="modal-dialog modal-dialog-centered">
			<form class="modal-content" id="editUserForm">
				<div class="modal-header">
					<h5 class="modal-title" id="modalTopTitle">Edit User</h5>
					<button
							type="button"
							class="btn-close"
							data-bs-dismiss="modal"
							aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<input type="hidden" id="editUserId">
					<div class="mb-3">
						<label for="editUsername" class="form-label">Username</label>
						<input type="text" class="form-control" id="editUsername" required>
					</div>
					<div class="mb-3">
						<label for="editEmail" class="form-label">Email</label>
						<input type="email" class="form-control" id="editEmail" required>
					</div>
					<div class="mb-3">
						<label for="editFirstName" class="form-label">First Name</label>
						<input type="text" class="form-control" id="editFirstName" required>
					</div>
					<div class="mb-3">
						<label for="editLastName" class="form-label">Last Name</label>
						<input type="text" class="form-control" id="editLastName" required>
					</div>
					<div class="mb-3">
						<label for="editPassword" class="form-label">Password</label>
						<input type="password" class="form-control" id="editPassword" placeholder="Leave blank to keep current password">
						<div class="form-text">Leave blank if you don't want to change the password</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="submit" class="btn btn-primary">Save Changes</button>
				</div>
			</form>
		</div>
	</div>
	<!-- /Edit Modal -->

	<!-- User Detail Modal -->
	<div class="modal fade" id="viewUserModal" tabindex="-1" aria-labelledby="viewUserModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="viewUserModalLabel">User Profile</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div class="text-center mb-4">
						<img src="/assets/img/profile.png" alt="User Avatar" class="rounded-circle" width="100" height="100">
						<h4 id="viewUserName" class="mt-2"></h4>
						<p id="viewUserUsername" class="text-muted"></p>
					</div>
					<div class="user-details">
						<div class="row mb-3">
							<div class="col-sm-4 text-muted">Email:</div>
							<div class="col-sm-8" id="viewUserEmail"></div>
						</div>
						<div class="row mb-3">
							<div class="col-sm-4 text-muted">First Name:</div>
							<div class="col-sm-8" id="viewUserFirstName"></div>
						</div>
						<div class="row mb-3">
							<div class="col-sm-4 text-muted">Last Name:</div>
							<div class="col-sm-8" id="viewUserLastName"></div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>
	<!-- /User Detail Modal -->

	<!--	user Modal end-->
	<!-- copyright -->
	<div class="copyright mt-150">
		<div class="container">
			<div class="row">
				<div class="col-lg-6 col-md-12">
					<p>&copy; Copyright Click 'n' Collect
						<script>
							document.write(new Date().getFullYear());
						</script>
					</p>
				</div>
				<div class="col-lg-6 text-right col-md-12">
					<div class="social-icons">
						<ul>
							<li><a href="#" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-twitter"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-instagram"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-linkedin"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-dribbble"></i></a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
<!--	Search Filter -->
	<script>
		function search() {
			const input = document.getElementById("keyword");
			const filter = input.value.toLowerCase();
			const table = document.querySelector("table");
			const rows = table.getElementsByTagName("tr");

			for (let i = 1; i < rows.length; i++) {
				const row = rows[i];
				let found = false;
				const cells = row.getElementsByTagName("td");

				for (let j = 0; j < cells.length; j++) {
					const cell = cells[j];
					if (cell && cell.textContent.toLowerCase().includes(filter)) {
						found = true;
						break;
					}
				}

				row.style.display = found ? "" : "none";
			}
		}
	</script>
<!--	Display Images script-->
	<script>
		const fileInput = document.getElementById("file-input");
		const container = document.getElementById("container");

		function loadFile() {
			container.innerHTML +=
					`<img src="${this.result}" width="150" height="100"/>`;
		}


		function addMultipleFiles() {
			container.innerHTML = "";

			for (const file of this.files) {
				let reader = new FileReader();
				reader.addEventListener("load", loadFile);
				reader.readAsDataURL(file);
			}
		}

		document.addEventListener("DOMContentLoaded", () => {
			fileInput.addEventListener("change", addMultipleFiles);

		});

	</script>
	<!-- end copyright -->
	<script th:src="@{/assets/bootstrap/js/bootstrap.js}"></script>
	<script th:src="@{/assets/bootstrap/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/assets/bootstrap/js/bootstrap.min.js}"></script>
	<script th:src="@{/assets/bootstrap/js/popper.js}"></script>
	<!-- jquery -->
	<script>//@ sourceMappingURL=</script>
	<script th:src="@{/assets/js/jquery-1.11.3.min.js}"></script>
	<!-- bootstrap -->
	<script th:src="@{/assets/bootstrap/js/bootstrap.min.js}"></script>
	<!-- count down -->
	<script th:src="@{/assets/js/jquery.countdown.js}"></script>
	<!-- isotope -->
	<script th:src="@{/assets/js/jquery.isotope-3.0.6.min.js}"></script>
	<!-- waypoints -->
	<script th:src="@{/assets/js/waypoints.js}"></script>
	<!-- owl carousel -->
	<script th:src="@{/assets/js/owl.carousel.min.js}"></script>
	<!-- magnific popup -->
	<script th:src="@{/assets/js/jquery.magnific-popup.min.js}"></script>
	<!-- mean menu -->
	<script th:src="@{/assets/js/jquery.meanmenu.min.js}"></script>
	<!-- sticker js -->
	<script th:src="@{/assets/js/sticker.js}"></script>
<!--	user js-->
	<script th:src="@{/assets/js/users_js/userManagent.js}"></script>

	<!-- main js -->
	<script th:src="@{/assets/js/main.js}"></script>
	<script th:src="@{/assets/bootstrap/js/bootstrap.js}"></script>
	<script th:src="@{/assets/bootstrap/js/bootstrap.bundle.js}"></script>
	<script th:src="@{/assets/bootstrap/js/popper.js}"></script>
	<script th:src="@{/assets/js/jquery.meanmenu.min.js}"></script>

	<script th:inline="javascript">
	// Show notifications
	function showNotifications() {
		fetch('/api/admin/notifications')
			.then(response => response.json())
			.then(notifications => {
				const tbody = document.getElementById('notificationsTableBody');
				tbody.innerHTML = notifications.map(notification => `
					<tr>
						<td>${new Date(notification.createdAt).toLocaleString()}</td>
						<td>${notification.product.name}</td>
						<td>
							<span class="badge ${getNotificationBadgeClass(notification.type)}">
								${notification.type}
							</span>
						</td>
						<td>${notification.message}</td>
						<td>
							${!notification.read ? `
								<button class="btn btn-sm btn-primary" 
										onclick="markNotificationAsRead(${notification.id})">
									Mark as Read
								</button>
							` : ''}
						</td>
					</tr>
				`).join('');
				
				document.getElementById('notifications-section').style.display = 'block';
			})
			.catch(error => {
				console.error('Error:', error);
				alert('Error loading notifications');
			});
	}

	function getNotificationBadgeClass(type) {
		switch(type) {
			case 'LOW_STOCK': return 'bg-warning';
			case 'OUT_OF_STOCK': return 'bg-danger';
			case 'ORDER_PLACED': return 'bg-info';
			case 'ORDER_CANCELLED': return 'bg-secondary';
			case 'STOCK_UPDATED': return 'bg-success';
			default: return 'bg-secondary';
		}
	}

	function markNotificationAsRead(notificationId) {
		fetch(`/api/admin/notifications/${notificationId}/read`, {
			method: 'POST'
		})
		.then(() => {
			showNotifications(); // Refresh notifications
			updateNotificationCount(); // Update notification count
		})
		.catch(error => {
			console.error('Error:', error);
			alert('Error marking notification as read');
		});
	}

	function markAllNotificationsAsRead() {
		fetch('/api/admin/notifications/read-all', {
			method: 'POST'
		})
		.then(() => {
			showNotifications(); // Refresh notifications
			updateNotificationCount(); // Update notification count
		})
		.catch(error => {
			console.error('Error:', error);
			alert('Error marking all notifications as read');
		});
	}

	function updateNotificationCount() {
		fetch('/api/admin/notifications/count')
			.then(response => response.json())
			.then(count => {
				document.querySelector('[th\\:text="${unreadNotificationCount}"]').textContent = count;
			});
	}

	// Update stock functions
	function updateStock(productId) {
		document.getElementById('productId').value = productId;
		new bootstrap.Modal(document.getElementById('updateStockModal')).show();
	}

	function submitStockUpdate() {
		const productId = document.getElementById('productId').value;
		const newStock = document.getElementById('newStock').value;

		if (!newStock || newStock < 0) {
			alert('Please enter a valid stock quantity (0 or greater)');
			return;
		}

		fetch(`/api/admin/products/${productId}/stock`, {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json'
			},
			body: JSON.stringify({ stockQuantity: parseInt(newStock) })
		})
		.then(response => response.json())
		.then(data => {
			if (data.error) {
				throw new Error(data.error);
			}
			// If we get here, the update was successful
			alert(data.message || 'Stock updated successfully');
			window.location.reload(); // Refresh to show updated stock
		})
		.catch(error => {
			console.error('Error:', error);
			alert('Error updating stock: ' + error.message);
		});
	}

	// Update notification count periodically
	setInterval(updateNotificationCount, 30000); // Every 30 seconds
	</script>

</body>
</html>